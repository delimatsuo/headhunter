---
phase: 05-skills-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - functions/src/shared/skills-master.ts
  - functions/src/shared/skills-service.ts
autonomous: true

must_haves:
  truths:
    - "skills-master.ts exists in functions/src/shared/ with 200+ skills"
    - "skills-service.ts provides O(1) alias normalization via pre-built Map"
    - "normalizeSkillName('JS') returns 'JavaScript'"
    - "normalizeSkillName('K8s') returns 'Kubernetes'"
    - "Skill lookups are case-insensitive"
  artifacts:
    - path: "functions/src/shared/skills-master.ts"
      provides: "EllaAI skills taxonomy with types, categories, and helper functions"
      contains: "MASTER_SKILLS"
    - path: "functions/src/shared/skills-service.ts"
      provides: "Search-optimized skill normalization"
      exports: ["normalizeSkillName", "skillsMatch", "getSkillAliases", "MASTER_SKILLS"]
  key_links:
    - from: "functions/src/shared/skills-service.ts"
      to: "functions/src/shared/skills-master.ts"
      via: "Import MASTER_SKILLS and helper functions"
      pattern: "from './skills-master'"
---

<objective>
Copy EllaAI skills taxonomy and create search-optimized wrapper service.

Purpose: Establish single source of truth for skills with O(1) lookups. This replaces scattered hardcoded synonym maps across the codebase with a centralized, efficient skills service.

Output:
- `functions/src/shared/skills-master.ts` - Copy of EllaAI taxonomy (200+ skills, aliases, categories)
- `functions/src/shared/skills-service.ts` - Search-optimized wrapper with Map-based lookups
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-skills-infrastructure/05-RESEARCH.md

# Source file (read-only reference)
# /Volumes/Extreme Pro/myprojects/EllaAI/react-spa/src/data/skills-master.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Copy skills-master.ts to shared directory</name>
  <files>functions/src/shared/skills-master.ts</files>
  <action>
1. Create the `functions/src/shared/` directory if it doesn't exist

2. Copy the entire EllaAI skills-master.ts file:
   - Source: `/Volumes/Extreme Pro/myprojects/EllaAI/react-spa/src/data/skills-master.ts`
   - Target: `functions/src/shared/skills-master.ts`

3. Add a header comment at the top noting the source:
   ```typescript
   /**
    * Skills Master Database - Single Source of Truth
    *
    * Copied from EllaAI: react-spa/src/data/skills-master.ts
    * Date: 2026-01-25
    *
    * This is a local copy for Headhunter customization and independence.
    * Contains 200+ skills with aliases, categories, and market data.
    */
   ```

4. Verify the file contains:
   - SkillCategory type
   - Skill interface with aliases field
   - SKILL_CATEGORIES array (15 categories)
   - MASTER_SKILLS array (200+ skills)
   - Helper functions: getSkillByName, matchSkillName, normalizeSkillToId, searchSkills

Do NOT modify the EllaAI file structure - copy as-is for maintainability.
  </action>
  <verify>
- `ls functions/src/shared/skills-master.ts` confirms file exists
- `grep -c "MASTER_SKILLS" functions/src/shared/skills-master.ts` shows array definition
- `grep "aliases.*JS" functions/src/shared/skills-master.ts` shows JavaScript alias
- `grep "aliases.*K8s" functions/src/shared/skills-master.ts` shows Kubernetes alias
  </verify>
  <done>
- skills-master.ts copied to functions/src/shared/
- File contains MASTER_SKILLS with 200+ skills
- Aliases include JS=JavaScript, K8s=Kubernetes, TS=TypeScript
- All EllaAI helper functions preserved
  </done>
</task>

<task type="auto">
  <name>Task 2: Create skills-service.ts wrapper with O(1) lookups</name>
  <files>functions/src/shared/skills-service.ts</files>
  <action>
Create a new module `functions/src/shared/skills-service.ts` with search-optimized functions:

1. **Build ALIAS_TO_CANONICAL Map at module load**:
   ```typescript
   import {
     MASTER_SKILLS,
     getSkillByName,
     matchSkillName,
     searchSkills,
     SKILL_CATEGORIES,
     type Skill,
     type SkillCategory
   } from './skills-master';

   // Build reverse alias map once at module load (O(n) once, O(1) lookups)
   const ALIAS_TO_CANONICAL = new Map<string, string>();
   for (const skill of MASTER_SKILLS) {
     // Map canonical name to itself (lowercase)
     ALIAS_TO_CANONICAL.set(skill.name.toLowerCase(), skill.name);
     // Map all aliases to canonical name
     if (skill.aliases) {
       for (const alias of skill.aliases) {
         ALIAS_TO_CANONICAL.set(alias.toLowerCase(), skill.name);
       }
     }
   }
   ```

2. **normalizeSkillName function** - O(1) normalization:
   ```typescript
   /**
    * Normalize any skill name/alias to canonical form.
    * O(1) lookup - safe for hot paths in search.
    *
    * @example
    * normalizeSkillName('JS') // => 'JavaScript'
    * normalizeSkillName('k8s') // => 'Kubernetes'
    * normalizeSkillName('PYTHON') // => 'Python'
    * normalizeSkillName('UnknownSkill') // => 'UnknownSkill' (passthrough)
    */
   export function normalizeSkillName(input: string): string {
     const normalized = input.toLowerCase().trim();
     return ALIAS_TO_CANONICAL.get(normalized) || input;
   }
   ```

3. **skillsMatch function** - Compare two skills accounting for aliases:
   ```typescript
   /**
    * Check if two skill names refer to the same skill.
    * Handles aliases and case differences.
    *
    * @example
    * skillsMatch('JavaScript', 'JS') // => true
    * skillsMatch('kubernetes', 'K8s') // => true
    * skillsMatch('Python', 'Java') // => false
    */
   export function skillsMatch(skill1: string, skill2: string): boolean {
     return normalizeSkillName(skill1) === normalizeSkillName(skill2);
   }
   ```

4. **getSkillAliases function** - Get all aliases for a skill:
   ```typescript
   /**
    * Get all known aliases for a canonical skill name.
    *
    * @example
    * getSkillAliases('JavaScript') // => ['JS', 'ECMAScript']
    * getSkillAliases('Kubernetes') // => ['K8s']
    */
   export function getSkillAliases(skillName: string): string[] {
     const skill = getSkillByName(skillName);
     return skill?.aliases || [];
   }
   ```

5. **getCanonicalSkillId function** - Get skill ID for database storage:
   ```typescript
   /**
    * Get the canonical skill ID for storage/indexing.
    *
    * @example
    * getCanonicalSkillId('JS') // => 'javascript'
    * getCanonicalSkillId('K8s') // => 'kubernetes'
    */
   export function getCanonicalSkillId(input: string): string {
     const skill = getSkillByName(input);
     return skill?.id || input.toLowerCase().replace(/[^a-z0-9]+/g, '-');
   }
   ```

6. **Re-export commonly used items** from skills-master:
   ```typescript
   // Re-export from skills-master for convenience
   export {
     MASTER_SKILLS,
     SKILL_CATEGORIES,
     getSkillByName,
     matchSkillName,
     searchSkills,
     type Skill,
     type SkillCategory
   } from './skills-master';
   ```

Log the map size at module load for verification:
```typescript
console.log(`[skills-service] Initialized with ${ALIAS_TO_CANONICAL.size} skill mappings`);
```
  </action>
  <verify>
- `npm run typecheck --prefix functions` passes (or tsc --noEmit in functions/)
- `grep "ALIAS_TO_CANONICAL" functions/src/shared/skills-service.ts` shows Map initialization
- `grep "normalizeSkillName" functions/src/shared/skills-service.ts` shows export
- `grep "skillsMatch" functions/src/shared/skills-service.ts` shows export
  </verify>
  <done>
- ALIAS_TO_CANONICAL Map built at module load with all aliases
- normalizeSkillName provides O(1) case-insensitive alias resolution
- skillsMatch compares skills accounting for aliases
- getSkillAliases returns all aliases for a skill
- getCanonicalSkillId returns normalized ID for storage
- All relevant items re-exported from skills-master
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: Verify functions directory compiles
   - `cd functions && npx tsc --noEmit` or `npm run build --prefix functions`

2. Alias verification (manual check or unit test):
   - Import normalizeSkillName and verify:
     - normalizeSkillName('JS') === 'JavaScript'
     - normalizeSkillName('K8s') === 'Kubernetes'
     - normalizeSkillName('PYTHON') === 'Python' (case insensitive)
     - normalizeSkillName('unknown') === 'unknown' (passthrough)

3. Skills count: Verify MASTER_SKILLS has 200+ entries
</verification>

<success_criteria>
- skills-master.ts copied with full EllaAI taxonomy (200+ skills, 15 categories)
- skills-service.ts provides O(1) normalizeSkillName function
- Alias normalization works: JS->JavaScript, K8s->Kubernetes, TS->TypeScript
- Case insensitivity works: PYTHON, Python, python all normalize to Python
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-skills-infrastructure/05-01-SUMMARY.md`
</output>
