---
phase: 05-skills-infrastructure
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - functions/src/skill-aware-search.ts
autonomous: true

must_haves:
  truths:
    - "Hardcoded synonymMap removed from skill-aware-search.ts"
    - "normalizeSkill method replaced with skills-service import"
    - "Skill normalization uses centralized 200+ skill taxonomy"
  artifacts:
    - path: "functions/src/skill-aware-search.ts"
      provides: "Skill-aware search using centralized skills service"
      contains: "from './shared/skills-service'"
  key_links:
    - from: "functions/src/skill-aware-search.ts"
      to: "functions/src/shared/skills-service.ts"
      via: "Import normalizeSkillName for alias resolution"
      pattern: "normalizeSkillName"
---

<objective>
Refactor skill-aware-search.ts to use centralized skills service instead of local normalizeSkill method.

Purpose: Replace the 7-entry hardcoded synonym map with the 200+ skill EllaAI taxonomy. This ensures consistent skill normalization across all skill-aware search paths.

Output:
- Updated `functions/src/skill-aware-search.ts` using skills-service for normalization
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-skills-infrastructure/05-RESEARCH.md

# Prior plan context (skills service now exists)
@.planning/phases/05-skills-infrastructure/05-01-SUMMARY.md

# Target file
@functions/src/skill-aware-search.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Import skills-service and remove local normalizeSkill method</name>
  <files>functions/src/skill-aware-search.ts</files>
  <action>
1. **Add import** near the top of the file (after other imports):
   ```typescript
   import { normalizeSkillName } from './shared/skills-service';
   ```

2. **Remove the local normalizeSkill method** (lines 130-146 approximately):
   ```typescript
   // DELETE THIS ENTIRE METHOD:
   private normalizeSkill(skill: string): string {
     const skillLower = skill.toLowerCase().trim();

     // Common skill synonyms
     const synonymMap: Record<string, string> = {
       "js": "javascript",
       "python3": "python",
       "py": "python",
       "k8s": "kubernetes",
       "ml": "machine learning",
       "ai": "artificial intelligence",
       "nodejs": "node.js",
       "pm": "project management"
     };

     return synonymMap[skillLower] || skillLower;
   }
   ```

3. **Update all usages** of `this.normalizeSkill()` to use `normalizeSkillName()`:
   - Search for `this.normalizeSkill(` throughout the file
   - Replace each occurrence with `normalizeSkillName(`
   - Note: `normalizeSkillName` returns canonical form (e.g., "JavaScript") not lowercase

4. **Handle return value difference**:
   - Old `normalizeSkill` returned lowercase (e.g., "javascript")
   - New `normalizeSkillName` returns canonical form (e.g., "JavaScript")
   - For comparisons, ensure both sides use normalizeSkillName OR add `.toLowerCase()` if needed for case-insensitive comparison

Example transformation:
```typescript
// BEFORE:
const normalizedSkill = this.normalizeSkill(skill);
if (candidateSkill === normalizedSkill) { ... }

// AFTER:
const normalizedSkill = normalizeSkillName(skill);
if (normalizeSkillName(candidateSkill) === normalizedSkill) { ... }
// OR for lowercase comparison:
if (candidateSkill.toLowerCase() === normalizedSkill.toLowerCase()) { ... }
```
  </action>
  <verify>
- `grep "from './shared/skills-service'" functions/src/skill-aware-search.ts` shows import
- `grep "private normalizeSkill" functions/src/skill-aware-search.ts` returns nothing (removed)
- `grep "synonymMap" functions/src/skill-aware-search.ts` returns nothing (removed)
- `grep "normalizeSkillName" functions/src/skill-aware-search.ts` shows usage
  </verify>
  <done>
- skills-service import added
- Local normalizeSkill method completely removed
- Hardcoded synonymMap removed
- All usages updated to normalizeSkillName from skills-service
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify TypeScript compilation and fix any type issues</name>
  <files>functions/src/skill-aware-search.ts</files>
  <action>
Run TypeScript compilation and fix any issues:

1. **Compile check**: `cd functions && npx tsc --noEmit`

2. **Common issues to watch for**:
   - Return type mismatch (normalizeSkillName returns string, should be fine)
   - Case sensitivity issues in comparisons
   - Missing import statement

3. **If compilation fails**, check:
   - Import path is correct: `'./shared/skills-service'`
   - No remaining references to `this.normalizeSkill`
   - No remaining references to local `synonymMap`

4. **Ensure skill comparisons are case-insensitive**:
   ```typescript
   // Safe pattern for skill comparison:
   const normalizedTarget = normalizeSkillName(targetSkill).toLowerCase();
   const normalizedCandidate = normalizeSkillName(candidateSkill).toLowerCase();
   if (normalizedTarget === normalizedCandidate) { ... }
   ```
  </action>
  <verify>
- `npm run typecheck --prefix functions` passes (or `cd functions && npx tsc --noEmit`)
- `grep -c "normalizeSkillName" functions/src/skill-aware-search.ts` shows expected count
  </verify>
  <done>
- TypeScript compiles without errors
- All skill comparisons use normalizeSkillName from skills-service
- No hardcoded synonyms remain in skill-aware-search.ts
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `npm run typecheck --prefix functions` or `cd functions && npx tsc --noEmit`
2. Synonym removal: `grep "synonymMap" functions/src/skill-aware-search.ts` returns nothing
3. Local method removal: `grep "private normalizeSkill" functions/src/skill-aware-search.ts` returns nothing
4. Import present: `grep "skills-service" functions/src/skill-aware-search.ts` shows import
</verification>

<success_criteria>
- Local normalizeSkill method completely removed
- Hardcoded synonymMap with 7 entries removed
- normalizeSkillName imported from skills-service
- All skill normalizations use centralized service
- TypeScript compiles without errors
- Skill normalization now benefits from 200+ EllaAI aliases
</success_criteria>

<output>
After completion, create `.planning/phases/05-skills-infrastructure/05-03-SUMMARY.md`
</output>
