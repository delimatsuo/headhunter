---
phase: 01-reranking-fix
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx
  - headhunter-ui/src/components/Search/SearchResults.tsx
autonomous: true

must_haves:
  truths:
    - "Match Score and Similarity Score are displayed as separate values in the UI"
    - "Users can visually confirm that LLM reranking is influencing results (scores differ)"
    - "Score badges use distinct colors to differentiate match vs similarity"
  artifacts:
    - path: "headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx"
      provides: "Dual score display in candidate cards"
      contains: "similarityScore"
    - path: "headhunter-ui/src/components/Search/SearchResults.tsx"
      provides: "Props passing for similarity score"
      contains: "similarity"
  key_links:
    - from: "SearchResults.tsx"
      to: "SkillAwareCandidateCard.tsx"
      via: "similarityScore prop"
      pattern: "similarityScore.*similarity"
---

<objective>
Display both Match Score and Similarity Score in the candidate cards so users can visually confirm reranking is working.

Purpose: With Plan 01 fixing the backend and Plan 02 fixing the API service, both scores are now available in the frontend. This plan updates the UI to display both scores, making it obvious when reranking is working (scores differ) vs broken (scores identical).

Output: Candidate cards that display both "Match Score" (LLM-influenced) and "Similarity" (raw vector) badges.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-reranking-fix/01-01-SUMMARY.md
@.planning/phases/01-reranking-fix/01-02-SUMMARY.md

# Key source files
@headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx
@headhunter-ui/src/components/Search/SearchResults.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add similarityScore prop to SkillAwareCandidateCard</name>
  <files>headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx</files>
  <action>
Update the interface and component props to accept a similarityScore prop.

1. Add to the interface (around line 8-18):

```typescript
interface SkillAwareCandidateCardProps {
  candidate: CandidateProfile;
  matchScore?: number;
  similarityScore?: number;  // NEW: Raw vector similarity score
  skillMatches?: SkillMatchData[];
  searchSkills?: string[];
  rank?: number;
  onClick?: () => void;
  showDetailedSkills?: boolean;
  onFindSimilar?: () => void;
  onEdit?: () => void;
}
```

2. Destructure the new prop (around line 20-30):

```typescript
export const SkillAwareCandidateCard: React.FC<SkillAwareCandidateCardProps> = ({
  candidate,
  matchScore,
  similarityScore,  // NEW
  skillMatches = [],
  searchSkills = [],
  rank,
  onClick,
  showDetailedSkills = false,
  onFindSimilar,
  onEdit,
}) => {
```
  </action>
  <verify>
Run: `grep -n "similarityScore" headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx | head -5`
Should show the prop in interface and destructuring.
  </verify>
  <done>
The SkillAwareCandidateCard accepts a similarityScore prop.
  </done>
</task>

<task type="auto">
  <name>Task 2: Display both scores as distinct badges</name>
  <files>headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx</files>
  <action>
Find where matchScore is currently displayed (look for usage of `matchScore` and `formatScore`). The existing display shows a single score badge. Update to show both.

Add a helper function to check if scores are meaningfully different (around line 77):

```typescript
const scoresAreDifferent = () => {
    if (matchScore === undefined || similarityScore === undefined) return false;
    const normalizedMatch = matchScore <= 1 ? matchScore * 100 : matchScore;
    const normalizedSim = similarityScore <= 1 ? similarityScore * 100 : similarityScore;
    return Math.abs(normalizedMatch - normalizedSim) > 1; // More than 1% difference
};
```

Find the score badge display section (search for class containing "score" or "badge"). Update it to show both scores:

```tsx
{/* Score badges - show both Match (LLM) and Similarity (Vector) */}
{matchScore !== undefined && (
  <div className="score-badges">
    <Tooltip title="LLM-influenced match score (considers qualitative fit)">
      <span className={`score-badge match ${getScoreColor(matchScore)}`}>
        Match: {formatScore(matchScore)}%
      </span>
    </Tooltip>
    {similarityScore !== undefined && scoresAreDifferent() && (
      <Tooltip title="Raw vector similarity (semantic profile match)">
        <span className={`score-badge similarity ${getScoreColor(similarityScore)}`}>
          Sim: {formatScore(similarityScore)}%
        </span>
      </Tooltip>
    )}
  </div>
)}
```

The key UX decisions:
- Match score always shows (primary score)
- Similarity only shows if different from match (avoids confusion when identical)
- Different tooltip text explains what each score means
- Different CSS classes allow distinct styling
  </action>
  <verify>
Run: `grep -n "score-badge.*similarity\|similarityScore.*formatScore" headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx`
Should show the similarity badge display code.
  </verify>
  <done>
Both Match Score and Similarity Score are displayed as separate badges with tooltips.
  </done>
</task>

<task type="auto">
  <name>Task 3: Pass similarityScore from SearchResults to SkillAwareCandidateCard</name>
  <files>headhunter-ui/src/components/Search/SearchResults.tsx</files>
  <action>
Find where SkillAwareCandidateCard is rendered (search for `<SkillAwareCandidateCard`). Update it to pass the similarity score.

The current rendering likely looks like:
```tsx
<SkillAwareCandidateCard
    candidate={match.candidate}
    matchScore={match.score}
    // ... other props
/>
```

Add the similarityScore prop:
```tsx
<SkillAwareCandidateCard
    candidate={match.candidate}
    matchScore={match.score}
    similarityScore={match.similarity}  // NEW: Pass raw similarity
    // ... other props
/>
```

The `match.similarity` value comes from the API service mapping we fixed in Plan 02.
  </action>
  <verify>
Run: `grep -n "similarityScore.*similarity" headhunter-ui/src/components/Search/SearchResults.tsx`
Should show the similarityScore prop being passed.
  </verify>
  <done>
SearchResults passes similarityScore to SkillAwareCandidateCard.
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Build the frontend:
   ```bash
   cd headhunter-ui && npm run build
   ```
   Should compile without TypeScript errors.

2. Verify prop interface:
   ```bash
   grep -A20 "interface SkillAwareCandidateCardProps" headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx
   ```
   Should include `similarityScore?: number;`

3. Verify prop passing:
   ```bash
   grep -n "similarityScore" headhunter-ui/src/components/Search/SearchResults.tsx
   ```
   Should show prop being passed.

4. Verify both badges displayed:
   ```bash
   grep -n "score-badge" headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx
   ```
   Should show both "match" and "similarity" badge classes.
</verification>

<success_criteria>
1. TypeScript compiles without errors
2. SkillAwareCandidateCard accepts and renders similarityScore prop
3. Both scores displayed with distinct styling (Match vs Sim)
4. Similarity badge only shows when scores are different (UX polish)
5. Tooltips explain what each score represents
</success_criteria>

<output>
After completion, create `.planning/phases/01-reranking-fix/01-03-SUMMARY.md`
</output>
