---
phase: 14-bias-reduction
plan: 06
type: execute
wave: 3
depends_on: ["14-03"]
files_modified:
  - headhunter-ui/src/components/Admin/BiasMetricsDashboard.tsx
  - headhunter-ui/src/components/Admin/BiasMetricsDashboard.css
  - headhunter-ui/src/components/Admin/SelectionRateChart.tsx
  - headhunter-ui/src/components/Admin/ImpactRatioAlert.tsx
  - headhunter-ui/src/components/Admin/AdminPage.tsx
  - headhunter-ui/src/services/api.ts
  - services/hh-admin-svc/src/routes.ts
autonomous: true

must_haves:
  truths:
    - "Admin dashboard displays selection rates by group"
    - "Impact ratio alerts appear when below 80% threshold"
    - "Trend data shown over configurable time period"
    - "Statistical significance warnings for small samples"
  artifacts:
    - path: "headhunter-ui/src/components/Admin/BiasMetricsDashboard.tsx"
      provides: "Main bias metrics dashboard component"
      min_lines: 150
    - path: "headhunter-ui/src/components/Admin/ImpactRatioAlert.tsx"
      provides: "Alert component for adverse impact warnings"
      exports: ["ImpactRatioAlert"]
    - path: "services/hh-admin-svc/src/routes.ts"
      provides: "API routes for bias metrics"
      contains: "bias-metrics"
  key_links:
    - from: "headhunter-ui/src/components/Admin/BiasMetricsDashboard.tsx"
      to: "headhunter-ui/src/services/api.ts"
      via: "fetch bias metrics via API"
      pattern: "getBiasMetrics"
---

<objective>
Create bias metrics dashboard for BIAS-03 (dashboard with selection rates) and BIAS-04 (impact ratio alerts).

Purpose: Give administrators visibility into selection patterns across demographic-proxy dimensions, with alerts when potential adverse impact is detected.

Output: React dashboard components, admin API routes, and API client integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-bias-reduction/14-RESEARCH.md

Key code files:
@headhunter-ui/src/components/Admin/AdminPage.tsx
@headhunter-ui/src/services/api.ts
@services/hh-admin-svc/src/routes.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add bias metrics API route to hh-admin-svc</name>
  <files>services/hh-admin-svc/src/routes.ts</files>
  <action>
Add bias metrics API routes to `services/hh-admin-svc/src/routes.ts`.

Add the following imports and routes:

```typescript
// Add to imports section
import { Pool } from 'pg';

// Add bias metrics routes after existing routes

/**
 * GET /admin/bias-metrics
 * Fetch computed bias metrics for the dashboard.
 */
app.get('/admin/bias-metrics', {
  schema: {
    querystring: {
      type: 'object',
      properties: {
        days: { type: 'number', default: 30 },
        dimension: { type: 'string', enum: ['company_tier', 'experience_band', 'specialty', 'all'] },
        tenant_id: { type: 'string' },
      },
    },
    response: {
      200: {
        type: 'object',
        properties: {
          computed_at: { type: 'string' },
          period: {
            type: 'object',
            properties: {
              days: { type: 'number' },
              start: { type: 'string' },
              end: { type: 'string' },
            },
          },
          dimensions: { type: 'object' },
          any_adverse_impact: { type: 'boolean' },
          all_warnings: { type: 'array', items: { type: 'string' } },
        },
      },
    },
  },
}, async (request, reply) => {
  const { days = 30, dimension = 'all', tenant_id } = request.query as {
    days?: number;
    dimension?: string;
    tenant_id?: string;
  };

  try {
    // Fetch latest computed metrics from database
    const pool = app.pg as Pool;
    const result = await pool.query(
      `SELECT metrics_json
       FROM bias_metrics
       WHERE ($1::text IS NULL OR tenant_id = $1)
       ORDER BY computed_at DESC
       LIMIT 1`,
      [tenant_id || null]
    );

    if (result.rows.length === 0) {
      // No metrics yet - return empty state
      return reply.send({
        computed_at: null,
        period: { days, start: null, end: null },
        dimensions: {},
        any_adverse_impact: false,
        all_warnings: ['No bias metrics computed yet. Run bias_metrics_worker.py to generate metrics.'],
      });
    }

    const metrics = result.rows[0].metrics_json;

    // Filter to requested dimension if not 'all'
    if (dimension !== 'all' && metrics.dimensions) {
      const filteredDimensions: Record<string, unknown> = {};
      if (metrics.dimensions[dimension]) {
        filteredDimensions[dimension] = metrics.dimensions[dimension];
      }
      metrics.dimensions = filteredDimensions;
    }

    return reply.send(metrics);
  } catch (error) {
    request.log.error({ error }, 'Failed to fetch bias metrics');
    return reply.status(500).send({ error: 'Failed to fetch bias metrics' });
  }
});

/**
 * GET /admin/bias-metrics/history
 * Fetch historical bias metrics for trend analysis.
 */
app.get('/admin/bias-metrics/history', {
  schema: {
    querystring: {
      type: 'object',
      properties: {
        days: { type: 'number', default: 90 },
        dimension: { type: 'string' },
        tenant_id: { type: 'string' },
      },
    },
  },
}, async (request, reply) => {
  const { days = 90, dimension, tenant_id } = request.query as {
    days?: number;
    dimension?: string;
    tenant_id?: string;
  };

  try {
    const pool = app.pg as Pool;
    const result = await pool.query(
      `SELECT computed_at, metrics_json
       FROM bias_metrics
       WHERE computed_at >= NOW() - INTERVAL '${days} days'
         AND ($1::text IS NULL OR tenant_id = $1)
       ORDER BY computed_at ASC`,
      [tenant_id || null]
    );

    const history = result.rows.map(row => ({
      date: row.computed_at,
      metrics: dimension
        ? row.metrics_json.dimensions?.[dimension]
        : row.metrics_json,
    }));

    return reply.send({ history, days, dimension });
  } catch (error) {
    request.log.error({ error }, 'Failed to fetch bias metrics history');
    return reply.status(500).send({ error: 'Failed to fetch metrics history' });
  }
});
```

Also add the database schema for bias_metrics table in a migration note:

```sql
-- Migration: Add bias_metrics table (to be run separately)
CREATE TABLE IF NOT EXISTS bias_metrics (
  id SERIAL PRIMARY KEY,
  tenant_id VARCHAR(255) NOT NULL DEFAULT 'default',
  computed_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
  metrics_json JSONB NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_bias_metrics_tenant_computed ON bias_metrics(tenant_id, computed_at DESC);
```
  </action>
  <verify>
    npx tsc --noEmit --project services/hh-admin-svc/tsconfig.json
  </verify>
  <done>
    Bias metrics API routes added to hh-admin-svc with schema validation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add bias metrics API client to UI</name>
  <files>headhunter-ui/src/services/api.ts</files>
  <action>
Add bias metrics API methods to `headhunter-ui/src/services/api.ts`:

```typescript
// Add these interfaces near other type definitions

export interface BiasMetricsParams {
  days?: number;
  dimension?: 'company_tier' | 'experience_band' | 'specialty' | 'all';
  tenantId?: string;
}

export interface DimensionMetrics {
  dimension: string;
  overall_rate: number;
  selection_rates: Record<string, number>;
  impact_ratios: Record<string, number>;
  sample_sizes: Record<string, number>;
  adverse_impact_detected: boolean;
  adverse_impact_groups: string[];
  low_sample_groups: string[];
  significance_tests: Record<string, {
    p_value: number;
    significant: boolean;
  }>;
  warnings: string[];
}

export interface BiasMetricsResponse {
  computed_at: string | null;
  period: {
    days: number;
    start: string | null;
    end: string | null;
  };
  dimensions: Record<string, DimensionMetrics>;
  any_adverse_impact: boolean;
  all_warnings: string[];
}

export interface BiasMetricsHistoryResponse {
  history: Array<{
    date: string;
    metrics: DimensionMetrics | Record<string, DimensionMetrics>;
  }>;
  days: number;
  dimension?: string;
}

// Add these methods to the api object or apiService class

/**
 * Fetch current bias metrics for the dashboard.
 */
async getBiasMetrics(params: BiasMetricsParams = {}): Promise<BiasMetricsResponse> {
  const searchParams = new URLSearchParams();
  if (params.days) searchParams.set('days', params.days.toString());
  if (params.dimension) searchParams.set('dimension', params.dimension);
  if (params.tenantId) searchParams.set('tenant_id', params.tenantId);

  const response = await fetch(
    `${this.adminServiceUrl}/admin/bias-metrics?${searchParams}`,
    {
      headers: this.getHeaders(),
    }
  );

  if (!response.ok) {
    throw new Error('Failed to fetch bias metrics');
  }

  return response.json();
}

/**
 * Fetch historical bias metrics for trend analysis.
 */
async getBiasMetricsHistory(params: BiasMetricsParams = {}): Promise<BiasMetricsHistoryResponse> {
  const searchParams = new URLSearchParams();
  if (params.days) searchParams.set('days', params.days.toString());
  if (params.dimension) searchParams.set('dimension', params.dimension);
  if (params.tenantId) searchParams.set('tenant_id', params.tenantId);

  const response = await fetch(
    `${this.adminServiceUrl}/admin/bias-metrics/history?${searchParams}`,
    {
      headers: this.getHeaders(),
    }
  );

  if (!response.ok) {
    throw new Error('Failed to fetch bias metrics history');
  }

  return response.json();
}
```
  </action>
  <verify>
    cd headhunter-ui && npx tsc --noEmit
  </verify>
  <done>
    Bias metrics API client methods added with proper TypeScript types.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create BiasMetricsDashboard and supporting components</name>
  <files>
    headhunter-ui/src/components/Admin/BiasMetricsDashboard.tsx
    headhunter-ui/src/components/Admin/BiasMetricsDashboard.css
    headhunter-ui/src/components/Admin/SelectionRateChart.tsx
    headhunter-ui/src/components/Admin/ImpactRatioAlert.tsx
    headhunter-ui/src/components/Admin/AdminPage.tsx
  </files>
  <action>
Create `headhunter-ui/src/components/Admin/ImpactRatioAlert.tsx`:

```tsx
import React from 'react';
import './BiasMetricsDashboard.css';

interface ImpactRatioAlertProps {
  dimension: string;
  affectedGroups: string[];
  impactRatios: Record<string, number>;
  warnings: string[];
}

export const ImpactRatioAlert: React.FC<ImpactRatioAlertProps> = ({
  dimension,
  affectedGroups,
  impactRatios,
  warnings,
}) => {
  if (affectedGroups.length === 0) {
    return null;
  }

  const formatDimension = (dim: string) => {
    return dim.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
  };

  return (
    <div className="impact-ratio-alert">
      <div className="alert-header">
        <span className="alert-icon">⚠️</span>
        <h4>Potential Adverse Impact Detected</h4>
      </div>

      <div className="alert-content">
        <p className="alert-dimension">
          <strong>Dimension:</strong> {formatDimension(dimension)}
        </p>

        <div className="affected-groups">
          <p><strong>Affected Groups (below 80% threshold):</strong></p>
          <ul>
            {affectedGroups.map(group => (
              <li key={group}>
                <span className="group-name">{group}</span>
                <span className="impact-ratio">
                  Impact Ratio: {(impactRatios[group] * 100).toFixed(1)}%
                </span>
              </li>
            ))}
          </ul>
        </div>

        {warnings.length > 0 && (
          <div className="alert-warnings">
            {warnings.map((warning, idx) => (
              <p key={idx} className="warning-text">{warning}</p>
            ))}
          </div>
        )}

        <div className="alert-action">
          <p>
            <strong>Recommended Action:</strong> Review selection criteria and consider
            whether current practices may disproportionately exclude qualified candidates
            from affected groups.
          </p>
        </div>
      </div>
    </div>
  );
};
```

Create `headhunter-ui/src/components/Admin/SelectionRateChart.tsx`:

```tsx
import React from 'react';
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  Legend,
  ResponsiveContainer,
  ReferenceLine,
} from 'recharts';

interface SelectionRateChartProps {
  dimension: string;
  selectionRates: Record<string, number>;
  impactRatios: Record<string, number>;
  sampleSizes: Record<string, number>;
  overallRate: number;
}

export const SelectionRateChart: React.FC<SelectionRateChartProps> = ({
  dimension,
  selectionRates,
  impactRatios,
  sampleSizes,
  overallRate,
}) => {
  const data = Object.entries(selectionRates).map(([group, rate]) => ({
    group,
    selectionRate: rate * 100,
    impactRatio: impactRatios[group] * 100,
    sampleSize: sampleSizes[group] || 0,
    belowThreshold: impactRatios[group] < 0.8,
  }));

  const formatDimension = (dim: string) => {
    return dim.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
  };

  return (
    <div className="selection-rate-chart">
      <h4>{formatDimension(dimension)}</h4>

      <ResponsiveContainer width="100%" height={300}>
        <BarChart data={data} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>
          <CartesianGrid strokeDasharray="3 3" />
          <XAxis dataKey="group" />
          <YAxis
            label={{ value: 'Selection Rate (%)', angle: -90, position: 'insideLeft' }}
            domain={[0, 100]}
          />
          <Tooltip
            content={({ active, payload }) => {
              if (active && payload && payload.length) {
                const data = payload[0].payload;
                return (
                  <div className="chart-tooltip">
                    <p><strong>{data.group}</strong></p>
                    <p>Selection Rate: {data.selectionRate.toFixed(1)}%</p>
                    <p>Impact Ratio: {data.impactRatio.toFixed(1)}%</p>
                    <p>Sample Size: {data.sampleSize}</p>
                    {data.belowThreshold && (
                      <p className="warning">⚠️ Below 80% threshold</p>
                    )}
                  </div>
                );
              }
              return null;
            }}
          />
          <Legend />
          <ReferenceLine
            y={overallRate * 100}
            stroke="#666"
            strokeDasharray="5 5"
            label={{ value: 'Overall', position: 'right' }}
          />
          <Bar
            dataKey="selectionRate"
            name="Selection Rate"
            fill={(entry: any) => entry.belowThreshold ? '#f44336' : '#4caf50'}
          />
        </BarChart>
      </ResponsiveContainer>

      <div className="sample-size-note">
        <p>Sample sizes: {Object.entries(sampleSizes).map(([g, n]) => `${g}: ${n}`).join(', ')}</p>
        {Object.values(sampleSizes).some(n => n < 20) && (
          <p className="small-sample-warning">
            ⚠️ Some groups have fewer than 20 candidates. Results may not be statistically significant.
          </p>
        )}
      </div>
    </div>
  );
};
```

Create `headhunter-ui/src/components/Admin/BiasMetricsDashboard.tsx`:

```tsx
import React, { useState, useEffect } from 'react';
import { api } from '../../services/api';
import { SelectionRateChart } from './SelectionRateChart';
import { ImpactRatioAlert } from './ImpactRatioAlert';
import './BiasMetricsDashboard.css';

interface DimensionMetrics {
  dimension: string;
  overall_rate: number;
  selection_rates: Record<string, number>;
  impact_ratios: Record<string, number>;
  sample_sizes: Record<string, number>;
  adverse_impact_detected: boolean;
  adverse_impact_groups: string[];
  low_sample_groups: string[];
  warnings: string[];
}

interface BiasMetricsResponse {
  computed_at: string | null;
  period: { days: number; start: string | null; end: string | null };
  dimensions: Record<string, DimensionMetrics>;
  any_adverse_impact: boolean;
  all_warnings: string[];
}

export const BiasMetricsDashboard: React.FC = () => {
  const [metrics, setMetrics] = useState<BiasMetricsResponse | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [selectedDays, setSelectedDays] = useState(30);

  useEffect(() => {
    loadMetrics();
  }, [selectedDays]);

  const loadMetrics = async () => {
    setLoading(true);
    setError(null);

    try {
      const data = await api.getBiasMetrics({ days: selectedDays, dimension: 'all' });
      setMetrics(data);
    } catch (err) {
      setError('Failed to load bias metrics. Make sure the bias metrics worker has been run.');
      console.error(err);
    } finally {
      setLoading(false);
    }
  };

  if (loading) {
    return (
      <div className="bias-metrics-dashboard loading">
        <div className="loading-spinner" />
        <p>Loading bias metrics...</p>
      </div>
    );
  }

  if (error) {
    return (
      <div className="bias-metrics-dashboard error">
        <p className="error-message">{error}</p>
        <button onClick={loadMetrics} className="retry-button">
          Retry
        </button>
      </div>
    );
  }

  if (!metrics || !metrics.computed_at) {
    return (
      <div className="bias-metrics-dashboard empty">
        <h3>No Bias Metrics Available</h3>
        <p>
          Bias metrics have not been computed yet. Run the bias metrics worker
          to generate selection rate data.
        </p>
        <pre className="code-snippet">
          python scripts/bias_metrics_worker.py --days 30 --all-dimensions --save-to-db
        </pre>
      </div>
    );
  }

  const dimensions = Object.values(metrics.dimensions);

  return (
    <div className="bias-metrics-dashboard">
      <div className="dashboard-header">
        <h2>Bias Metrics Dashboard</h2>
        <p className="subtitle">
          Selection rate analysis for EEOC compliance monitoring
        </p>

        <div className="period-selector">
          <label>Analysis Period:</label>
          <select
            value={selectedDays}
            onChange={(e) => setSelectedDays(Number(e.target.value))}
          >
            <option value={7}>Last 7 days</option>
            <option value={30}>Last 30 days</option>
            <option value={90}>Last 90 days</option>
          </select>
        </div>

        <p className="computed-at">
          Last computed: {new Date(metrics.computed_at).toLocaleString()}
        </p>
      </div>

      {/* Adverse Impact Alerts */}
      {metrics.any_adverse_impact && (
        <div className="alerts-section">
          <h3>Adverse Impact Alerts</h3>
          {dimensions
            .filter(d => d.adverse_impact_detected)
            .map(dim => (
              <ImpactRatioAlert
                key={dim.dimension}
                dimension={dim.dimension}
                affectedGroups={dim.adverse_impact_groups}
                impactRatios={dim.impact_ratios}
                warnings={dim.warnings}
              />
            ))}
        </div>
      )}

      {/* All Warnings Summary */}
      {metrics.all_warnings.length > 0 && (
        <div className="warnings-summary">
          <h3>Summary Warnings</h3>
          <ul>
            {metrics.all_warnings.map((warning, idx) => (
              <li key={idx}>{warning}</li>
            ))}
          </ul>
        </div>
      )}

      {/* Charts Section */}
      <div className="charts-section">
        <h3>Selection Rates by Dimension</h3>
        <p className="section-description">
          The four-fifths rule (80% threshold) is shown for adverse impact detection.
          Groups with selection rates below 80% of the highest group are flagged.
        </p>

        <div className="charts-grid">
          {dimensions.map(dim => (
            <SelectionRateChart
              key={dim.dimension}
              dimension={dim.dimension}
              selectionRates={dim.selection_rates}
              impactRatios={dim.impact_ratios}
              sampleSizes={dim.sample_sizes}
              overallRate={dim.overall_rate}
            />
          ))}
        </div>
      </div>

      {/* Methodology Note */}
      <div className="methodology-note">
        <h4>Methodology</h4>
        <p>
          Selection rates are calculated using Fairlearn's MetricFrame. The impact
          ratio compares each group's selection rate to the highest-selected group.
          A ratio below 0.8 (80%) indicates potential adverse impact per the
          four-fifths rule (29 CFR 1607.4).
        </p>
        <p>
          <strong>Important:</strong> This analysis uses inferred dimensions
          (company tier, experience band, specialty) as demographic proxies.
          It does not use actual protected characteristic data.
        </p>
      </div>
    </div>
  );
};
```

Create `headhunter-ui/src/components/Admin/BiasMetricsDashboard.css`:

```css
.bias-metrics-dashboard {
  padding: 24px;
  max-width: 1200px;
  margin: 0 auto;
}

.bias-metrics-dashboard.loading,
.bias-metrics-dashboard.error,
.bias-metrics-dashboard.empty {
  text-align: center;
  padding: 48px 24px;
}

.loading-spinner {
  width: 40px;
  height: 40px;
  border: 4px solid #e0e0e0;
  border-top-color: #1976d2;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 16px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.error-message {
  color: #f44336;
  margin-bottom: 16px;
}

.retry-button {
  background: #1976d2;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
}

.code-snippet {
  background: #f5f5f5;
  padding: 12px;
  border-radius: 6px;
  font-family: monospace;
  font-size: 13px;
  overflow-x: auto;
}

.dashboard-header {
  margin-bottom: 24px;
}

.dashboard-header h2 {
  margin: 0 0 8px 0;
}

.subtitle {
  color: #666;
  margin: 0 0 16px 0;
}

.period-selector {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}

.period-selector select {
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 14px;
}

.computed-at {
  font-size: 12px;
  color: #888;
  margin: 0;
}

.alerts-section {
  margin-bottom: 24px;
}

.alerts-section h3 {
  color: #f44336;
  margin-bottom: 12px;
}

.impact-ratio-alert {
  background: #ffebee;
  border: 1px solid #ffcdd2;
  border-left: 4px solid #f44336;
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 12px;
}

.alert-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
}

.alert-header h4 {
  margin: 0;
  color: #c62828;
}

.alert-icon {
  font-size: 20px;
}

.alert-content p {
  margin: 8px 0;
}

.affected-groups ul {
  margin: 8px 0;
  padding-left: 20px;
}

.affected-groups li {
  margin-bottom: 4px;
}

.group-name {
  font-weight: 600;
  margin-right: 8px;
}

.impact-ratio {
  color: #f44336;
  font-size: 13px;
}

.alert-warnings {
  background: rgba(255, 255, 255, 0.5);
  padding: 8px;
  border-radius: 4px;
  margin: 8px 0;
}

.warning-text {
  font-size: 13px;
  color: #555;
  margin: 4px 0;
}

.alert-action {
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  padding-top: 12px;
  margin-top: 12px;
}

.warnings-summary {
  background: #fff3e0;
  border-left: 4px solid #ff9800;
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 24px;
}

.warnings-summary h3 {
  margin: 0 0 8px 0;
  color: #e65100;
}

.warnings-summary ul {
  margin: 0;
  padding-left: 20px;
}

.warnings-summary li {
  margin-bottom: 4px;
  font-size: 14px;
}

.charts-section {
  margin-bottom: 24px;
}

.charts-section h3 {
  margin-bottom: 8px;
}

.section-description {
  color: #666;
  font-size: 14px;
  margin-bottom: 16px;
}

.charts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 24px;
}

.selection-rate-chart {
  background: #fff;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  padding: 16px;
}

.selection-rate-chart h4 {
  margin: 0 0 12px 0;
  text-align: center;
}

.chart-tooltip {
  background: white;
  border: 1px solid #ddd;
  padding: 10px;
  border-radius: 6px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.chart-tooltip p {
  margin: 4px 0;
  font-size: 13px;
}

.chart-tooltip .warning {
  color: #f44336;
  font-weight: 500;
}

.sample-size-note {
  margin-top: 12px;
  font-size: 12px;
  color: #666;
}

.small-sample-warning {
  color: #ff9800;
  font-weight: 500;
}

.methodology-note {
  background: #f5f5f5;
  padding: 16px;
  border-radius: 8px;
  margin-top: 24px;
}

.methodology-note h4 {
  margin: 0 0 8px 0;
}

.methodology-note p {
  font-size: 13px;
  color: #555;
  margin: 8px 0;
}
```

Update `headhunter-ui/src/components/Admin/AdminPage.tsx` to include the dashboard:

```tsx
import React, { useState } from 'react';
import { AllowedUsersPanel } from './AllowedUsersPanel';
import { BiasMetricsDashboard } from './BiasMetricsDashboard';
import './AdminPage.css';

type AdminTab = 'users' | 'bias';

export const AdminPage: React.FC = () => {
  const [activeTab, setActiveTab] = useState<AdminTab>('users');

  return (
    <div className="admin-page">
      <div className="dashboard-header">
        <h1>Admin</h1>
        <p>Manage access control and monitor bias metrics</p>
      </div>

      <div className="admin-tabs">
        <button
          className={`tab-button ${activeTab === 'users' ? 'active' : ''}`}
          onClick={() => setActiveTab('users')}
        >
          Access Control
        </button>
        <button
          className={`tab-button ${activeTab === 'bias' ? 'active' : ''}`}
          onClick={() => setActiveTab('bias')}
        >
          Bias Metrics
        </button>
      </div>

      <div className="tab-content">
        {activeTab === 'users' && <AllowedUsersPanel />}
        {activeTab === 'bias' && <BiasMetricsDashboard />}
      </div>
    </div>
  );
};
```

Add tab styles to AdminPage.css (create if not exists):

```css
.admin-tabs {
  display: flex;
  gap: 0;
  border-bottom: 2px solid #e0e0e0;
  margin-bottom: 24px;
}

.tab-button {
  background: none;
  border: none;
  padding: 12px 24px;
  font-size: 14px;
  font-weight: 500;
  color: #666;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  margin-bottom: -2px;
  transition: all 0.2s ease;
}

.tab-button:hover {
  color: #1976d2;
}

.tab-button.active {
  color: #1976d2;
  border-bottom-color: #1976d2;
}

.tab-content {
  min-height: 400px;
}
```
  </action>
  <verify>
    cd headhunter-ui && npx tsc --noEmit
  </verify>
  <done>
    BiasMetricsDashboard, SelectionRateChart, and ImpactRatioAlert components created. AdminPage updated with tab navigation.
  </done>
</task>

</tasks>

<verification>
- Admin service compiles: `npx tsc --noEmit --project services/hh-admin-svc/tsconfig.json`
- UI compiles: `cd headhunter-ui && npx tsc --noEmit`
- Dashboard renders: Start dev server and navigate to Admin page
- Charts display: Visual verification with sample data
- Alerts appear: Visual verification when adverse impact detected
</verification>

<success_criteria>
1. /admin/bias-metrics API route returns metrics from database
2. /admin/bias-metrics/history API route returns historical data
3. BiasMetricsDashboard displays selection rates by dimension
4. SelectionRateChart shows bar chart with 80% threshold line
5. ImpactRatioAlert appears when any group below 80% of highest
6. Period selector allows 7/30/90 day analysis
7. Methodology note explains four-fifths rule
8. All components compile without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/14-bias-reduction/14-06-SUMMARY.md`
</output>
