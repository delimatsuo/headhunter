---
phase: 09-match-transparency
plan: 03
type: execute
wave: 2
depends_on: ["09-01", "09-02"]
files_modified:
  - headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx
  - headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.css
autonomous: true

must_haves:
  truths:
    - "Candidate card shows expandable signal score breakdown"
    - "Inferred skills display with confidence badges in skill cloud"
    - "Match score and signal scores visible to recruiters"
  artifacts:
    - path: "headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx"
      provides: "Enhanced candidate card with signal breakdown integration"
      contains: "SignalScoreBreakdown"
  key_links:
    - from: "headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx"
      to: "SignalScoreBreakdown"
      via: "import"
      pattern: "SignalScoreBreakdown"
    - from: "headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx"
      to: "SkillChip"
      via: "import"
      pattern: "SkillChip"
---

<objective>
Integrate SignalScoreBreakdown and SkillChip components into the existing SkillAwareCandidateCard to display transparency features.

Purpose: TRNS-01 (match score visible), TRNS-02 (component scores shown), TRNS-04 (inferred skills with confidence). Recruiters need to see the signal breakdown and understand skill confidence levels.

Output: Enhanced candidate card with expandable signal score section and confidence badges on inferred skills.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase research with UI insertion points
@.planning/phases/09-match-transparency/09-RESEARCH.md

# Plan 01 summary for SignalScoreBreakdown
@.planning/phases/09-match-transparency/09-01-SUMMARY.md

# Plan 02 summary for SkillChip
@.planning/phases/09-match-transparency/09-02-SUMMARY.md

# Existing candidate card component to enhance
@headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx

# Backend types showing intelligent_analysis structure
@headhunter-ui/src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SignalScoreBreakdown to candidate card</name>
  <files>headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx</files>
  <action>
Integrate the SignalScoreBreakdown component into SkillAwareCandidateCard:

1. Add new props to SkillAwareCandidateCardProps interface:
```typescript
interface SkillAwareCandidateCardProps {
  // ... existing props
  signalScores?: SignalScores;
  weightsApplied?: SignalWeightConfig;
  roleTypeUsed?: string;
}
```

2. Import the new components at top of file:
```typescript
import { SignalScoreBreakdown } from '../Match/SignalScoreBreakdown';
import { SkillChip } from '../Match/SkillChip';
import { SignalScores, SignalWeightConfig } from '../../types';
```

3. Add state for signal breakdown expansion:
```typescript
const [signalBreakdownExpanded, setSignalBreakdownExpanded] = useState(false);
```

4. Add signal breakdown section after the AI hero section (around line 543):
- Add a "Score Breakdown" toggle button/section header
- When expanded, render `<SignalScoreBreakdown signalScores={signalScores} weightsApplied={weightsApplied} />`
- Use existing expand/collapse pattern (chevron icon, smooth animation)
- Only render if signalScores prop is provided

5. Add section styling matching existing expanded-section patterns in the CSS

Example insertion:
```tsx
{/* Signal Score Breakdown - after AI hero section */}
{signalScores && (
  <div className="signal-breakdown-section">
    <button
      className="breakdown-toggle"
      onClick={() => setSignalBreakdownExpanded(!signalBreakdownExpanded)}
    >
      <span>Score Breakdown</span>
      <span className={`chevron ${signalBreakdownExpanded ? 'expanded' : ''}`}>â–¼</span>
    </button>
    {signalBreakdownExpanded && (
      <SignalScoreBreakdown
        signalScores={signalScores}
        weightsApplied={weightsApplied}
      />
    )}
  </div>
)}
```
  </action>
  <verify>
- `npm run build` succeeds
- Card renders with signalScores prop
- Toggle expands/collapses signal breakdown
  </verify>
  <done>Signal score breakdown integrated into candidate card with expand/collapse</done>
</task>

<task type="auto">
  <name>Task 2a: Add getSkillsForDisplay helper function</name>
  <files>headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx</files>
  <action>
Add helper function to collect and format skills for display:

```typescript
// Add this interface near the top of the file (after imports)
interface SkillDisplayData {
  skill: string;
  type: 'explicit' | 'inferred';
  confidence: number;
  evidence?: string;
}

// Add this helper function inside the component, before the return statement
const getSkillsForDisplay = (): SkillDisplayData[] => {
  const explicit = candidate.intelligent_analysis?.explicit_skills?.technical_skills || [];
  const inferredHigh = candidate.intelligent_analysis?.inferred_skills?.highly_probable_skills || [];
  const inferredMedium = candidate.intelligent_analysis?.inferred_skills?.probable_skills || [];
  const inferredLow = candidate.intelligent_analysis?.inferred_skills?.likely_skills || [];

  // Map explicit skills to display format
  const explicitChips: SkillDisplayData[] = explicit.map(s => ({
    skill: typeof s === 'string' ? s : s.skill,
    type: 'explicit' as const,
    confidence: 1,
  }));

  // Map inferred skills with their confidence levels
  const inferredChips: SkillDisplayData[] = [
    ...inferredHigh.map(s => ({
      skill: s.skill,
      type: 'inferred' as const,
      confidence: s.confidence,
      evidence: s.reasoning
    })),
    ...inferredMedium.map(s => ({
      skill: s.skill,
      type: 'inferred' as const,
      confidence: s.confidence,
      evidence: s.reasoning
    })),
    ...inferredLow.map(s => ({
      skill: s.skill,
      type: 'inferred' as const,
      confidence: s.confidence,
      evidence: s.reasoning
    })),
  ];

  // Combine and limit to 15 total skills
  return [...explicitChips, ...inferredChips].slice(0, 15);
};
```

This helper:
- Collects explicit skills from `intelligent_analysis.explicit_skills.technical_skills`
- Collects inferred skills from three confidence tiers
- Normalizes to common `SkillDisplayData` interface
- Limits display to 15 skills for UI consistency
  </action>
  <verify>
- TypeScript compilation passes
- Function returns array of SkillDisplayData objects
  </verify>
  <done>Helper function added to collect and format skills for SkillChip rendering</done>
</task>

<task type="auto">
  <name>Task 2b: Update skills cloud rendering to use SkillChip</name>
  <files>headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx</files>
  <action>
Update the skills cloud section (around lines 546-562) to use SkillChip with the helper:

1. Import SkillChip at top of file:
```typescript
import { SkillChip } from '../Match/SkillChip';
```

2. Replace existing skill rendering in the skills cloud section:
```tsx
<div className="skills-cloud">
  {getSkillsForDisplay().map((skillData, idx) => (
    <SkillChip
      key={`${skillData.skill}-${idx}`}
      skill={skillData.skill}
      type={skillData.type}
      confidence={skillData.confidence}
      evidence={skillData.evidence}
      isMatched={searchSkills?.some(s =>
        s.toLowerCase() === skillData.skill.toLowerCase()
      )}
    />
  ))}
</div>
```

3. Remove or comment out old skill rendering code that doesn't show confidence badges
  </action>
  <verify>
- Skills display with appropriate badges (explicit vs inferred)
- High confidence skills show green "High" badge
- Hover shows evidence tooltip for inferred skills
  </verify>
  <done>Skills cloud uses SkillChip components with confidence indicators</done>
</task>

<task type="auto">
  <name>Task 3: Add CSS for signal breakdown section</name>
  <files>headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.css</files>
  <action>
Add styling for the signal breakdown section:

```css
/* Signal Breakdown Section */
.signal-breakdown-section {
  margin-top: 16px;
  border-top: 1px solid #e0e0e0;
  padding-top: 12px;
}

.breakdown-toggle {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  padding: 8px 12px;
  background: #f5f5f5;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  color: #424242;
  transition: background-color 0.2s ease;
}

.breakdown-toggle:hover {
  background: #eeeeee;
}

.breakdown-toggle .chevron {
  font-size: 12px;
  transition: transform 0.2s ease;
}

.breakdown-toggle .chevron.expanded {
  transform: rotate(180deg);
}

/* Updated skills cloud to accommodate SkillChip */
.skills-cloud {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 8px;
}
```

These styles:
- Create a distinct section for signal breakdown
- Match existing expand/collapse button patterns
- Ensure smooth chevron rotation animation
- Update skills cloud layout for SkillChip components
  </action>
  <verify>CSS syntax is valid, styles apply to signal breakdown section</verify>
  <done>Signal breakdown section styled consistently with existing card design</done>
</task>

</tasks>

<verification>
1. Run `npm run build` in headhunter-ui - should complete without errors
2. Candidate card accepts signalScores prop and renders breakdown toggle
3. Clicking toggle expands/collapses signal score visualization
4. Skills cloud shows:
   - Explicit skills: Blue solid styling, no badge
   - High confidence inferred: Green border, "High" badge
   - Medium confidence inferred: Orange border, "Likely" badge
   - Low confidence inferred: Gray border, "Possible" badge
5. Matched skills (from search) have green ring highlight
6. Tooltip shows reasoning on inferred skill hover
</verification>

<success_criteria>
1. TRNS-01: Match score visible (already present + signal breakdown)
2. TRNS-02: Component scores shown via SignalScoreBreakdown
3. TRNS-04: Inferred skills display with confidence badges
4. Expand/collapse works smoothly
5. TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/09-match-transparency/09-03-SUMMARY.md`
</output>
