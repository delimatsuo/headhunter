---
phase: 09-match-transparency
plan: 06
type: execute
wave: 3
depends_on: ["09-03", "09-05"]
files_modified:
  - headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx
  - headhunter-ui/src/types/index.ts
  - headhunter-ui/src/components/Search/SearchPage.tsx
  - headhunter-ui/src/components/Search/SearchResults.tsx
autonomous: true

must_haves:
  truths:
    - "Top candidates display LLM rationale in card UI"
    - "Rationale shows summary and key strengths"
    - "Signal highlights link to signal breakdown"
  artifacts:
    - path: "headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx"
      provides: "LLM rationale display in candidate card"
      contains: "matchRationale"
    - path: "headhunter-ui/src/types/index.ts"
      provides: "MatchRationale type in frontend"
      contains: "signalHighlights"
  key_links:
    - from: "headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx"
      to: "MatchRationale interface"
      via: "props"
      pattern: "matchRationale.*MatchRationale"
    - from: "headhunter-ui/src/components/Search/SearchPage.tsx"
      to: "apiService.searchWithEngine"
      via: "API request options"
      pattern: "includeMatchRationale.*true"
---

<objective>
Display the LLM-generated match rationale in the candidate card UI for top candidates.

Purpose: Complete TRNS-03 by surfacing the backend rationale in the frontend. Recruiters see "Why this candidate matches" with AI-generated insights.

Output: Candidate card displays rationale summary, key strengths as bullets, and signal highlights when matchRationale prop is provided.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase research with rationale UI design
@.planning/phases/09-match-transparency/09-RESEARCH.md

# Plan 05 summary for backend rationale
@.planning/phases/09-match-transparency/09-05-SUMMARY.md

# Existing candidate card to enhance
@headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx
@headhunter-ui/src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add MatchRationale type to frontend</name>
  <files>headhunter-ui/src/types/index.ts</files>
  <action>
Add the MatchRationale interface to match the backend structure:

```typescript
/**
 * LLM-generated match rationale for top candidates.
 * Provides human-readable explanation of candidate-job fit.
 */
export interface MatchRationale {
  /** 2-3 sentence summary of why candidate matches */
  summary: string;
  /** Top 2-3 key strengths */
  keyStrengths: string[];
  /** Which signals drove the match */
  signalHighlights: Array<{
    signal: string;
    score: number;
    reason: string;
  }>;
}
```

Update CandidateMatch interface to include rationale from backend:
```typescript
export interface CandidateMatch {
  candidate: CandidateProfile;
  score: number;
  similarity: number;
  rationale: MatchRationale;  // Existing (static)
  signalScores?: SignalScores;
  weightsApplied?: SignalWeightConfig;
  roleTypeUsed?: string;
  matchRationale?: MatchRationale;  // NEW: LLM-generated (TRNS-03)
}
```

Note: Keep existing `rationale` field (static from backend) separate from new `matchRationale` (LLM-generated).
  </action>
  <verify>TypeScript compilation passes</verify>
  <done>MatchRationale type added and CandidateMatch extended</done>
</task>

<task type="auto">
  <name>Task 2: Display LLM rationale in candidate card</name>
  <files>headhunter-ui/src/components/Candidate/SkillAwareCandidateCard.tsx</files>
  <action>
Add LLM rationale display to the candidate card:

1. Add prop for matchRationale:
```typescript
interface SkillAwareCandidateCardProps {
  // ... existing props
  matchRationale?: MatchRationale;
}
```

2. Import MatchRationale type:
```typescript
import { CandidateProfile, SkillAssessment, SkillMatchData, MatchRationale } from '../../types';
```

3. Add rationale section after the existing AI hero section (around line 543):
```tsx
{/* LLM Match Rationale - TRNS-03 */}
{matchRationale && matchRationale.summary && (
  <div className="match-rationale-section">
    <h4 className="rationale-header">
      <span className="ai-icon">âœ¨</span>
      Why This Candidate Matches
    </h4>

    <p className="rationale-summary">{matchRationale.summary}</p>

    {matchRationale.keyStrengths.length > 0 && (
      <div className="key-strengths">
        <span className="strengths-label">Key Strengths:</span>
        <ul className="strengths-list">
          {matchRationale.keyStrengths.map((strength, idx) => (
            <li key={idx}>{strength}</li>
          ))}
        </ul>
      </div>
    )}

    {matchRationale.signalHighlights.length > 0 && (
      <div className="signal-highlights">
        {matchRationale.signalHighlights.map((highlight, idx) => (
          <div key={idx} className="signal-highlight">
            <span className="signal-name">{highlight.signal}</span>
            <span className="signal-score">{Math.round(highlight.score * 100)}%</span>
            <span className="signal-reason">{highlight.reason}</span>
          </div>
        ))}
      </div>
    )}
  </div>
)}
```

4. Add CSS for rationale section in SkillAwareCandidateCard.css:
```css
/* LLM Match Rationale Section */
.match-rationale-section {
  margin-top: 16px;
  padding: 16px;
  background: linear-gradient(135deg, #f3e5f5 0%, #e8f5e9 100%);
  border-radius: 12px;
  border-left: 4px solid #7c4dff;
}

.rationale-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 0 0 12px 0;
  font-size: 14px;
  font-weight: 600;
  color: #5e35b1;
}

.rationale-header .ai-icon {
  font-size: 16px;
}

.rationale-summary {
  margin: 0 0 12px 0;
  font-size: 14px;
  line-height: 1.5;
  color: #424242;
}

.key-strengths {
  margin-bottom: 12px;
}

.strengths-label {
  font-size: 12px;
  font-weight: 600;
  color: #616161;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.strengths-list {
  margin: 8px 0 0 0;
  padding-left: 20px;
}

.strengths-list li {
  font-size: 13px;
  color: #424242;
  margin-bottom: 4px;
}

.signal-highlights {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.signal-highlight {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 12px;
  background: white;
  border-radius: 8px;
  font-size: 12px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.signal-name {
  font-weight: 600;
  color: #5e35b1;
}

.signal-score {
  font-weight: 700;
  color: #2e7d32;
}

.signal-reason {
  color: #757575;
  font-style: italic;
}
```
  </action>
  <verify>
- Candidate card renders matchRationale when provided
- Summary, key strengths, and signal highlights display
- Styling matches design spec (gradient background, purple accent)
  </verify>
  <done>LLM rationale displays in candidate card with summary and highlights</done>
</task>

<task type="auto">
  <name>Task 3: Add includeMatchRationale to API request</name>
  <files>headhunter-ui/src/components/Search/SearchPage.tsx</files>
  <action>
Update SearchPage.tsx to include `includeMatchRationale: true` in API request:

In the `handleSearch` function, update the `searchWithEngine` call to request rationales:

```typescript
const results = await apiService.searchWithEngine(
  selectedEngine,
  jobDescription,
  {
    limit: 50,
    includeMatchRationale: true,  // NEW: Request LLM rationale for top 10
    sourcingStrategy: {
      target_companies: sourcingStrategy?.target_companies,
      target_industries: sourcingStrategy?.target_industries,
    }
  }
);
```

This ensures the backend generates LLM rationales for top candidates (Plan 09-05).
Without this flag, rationales won't be generated even if the backend supports them.
  </action>
  <verify>
- Network tab shows `includeMatchRationale: true` in request payload
- Response includes `matchRationale` field for top 10 results
  </verify>
  <done>API request includes includeMatchRationale flag to trigger backend rationale generation</done>
</task>

<task type="auto">
  <name>Task 4: Wire rationale through SearchResults</name>
  <files>headhunter-ui/src/components/Search/SearchResults.tsx</files>
  <action>
Pass the matchRationale from search results to candidate cards:

1. Update the candidate card rendering to pass matchRationale:
```tsx
{displayedMatches.map((match, index) => (
  <SkillAwareCandidateCard
    key={match.candidate.id || match.candidate.candidate_id || index}
    candidate={match.candidate}
    matchScore={match.score}
    similarityScore={match.similarity}
    rank={index + 1}
    signalScores={match.signalScores}        // From 09-03
    weightsApplied={match.weightsApplied}    // From 09-03
    matchRationale={match.matchRationale}    // NEW: LLM rationale
    onFindSimilar={onFindSimilar ? () => onFindSimilar(match.candidate.candidate_id || '') : undefined}
    onEdit={() => handleEditClick(match.candidate)}
  />
))}
```

Note: matchRationale will only be present for top 10 candidates (from backend).
Candidates #11+ will not have rationale and the section simply won't render.
  </action>
  <verify>
- Top 10 candidates show "Why This Candidate Matches" section
- Candidates #11+ do not show rationale section (no errors)
  </verify>
  <done>matchRationale passed from search results to candidate cards</done>
</task>

</tasks>

<verification>
1. Run `npm run build` in headhunter-ui - should complete without errors
2. Mock search with matchRationale data for top 10 candidates
3. Verify card displays:
   - "Why This Candidate Matches" header with AI icon
   - Summary paragraph
   - Key strengths as bullet list
   - Signal highlights with name, score, reason
4. Verify card #11+ does not show rationale (graceful handling)
5. Visual check: Gradient background, purple accent, clean layout
</verification>

<success_criteria>
1. TRNS-03 complete: LLM-generated match rationale visible for top candidates
2. Rationale shows summary, key strengths, signal highlights
3. Visual design matches mockup (gradient, purple accent)
4. Graceful fallback when matchRationale is undefined
5. TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/09-match-transparency/09-06-SUMMARY.md`
</output>
