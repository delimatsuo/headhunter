---
phase: 04-multi-signal-scoring-framework
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - services/hh-search-svc/src/signal-weights.ts
  - services/hh-search-svc/src/config.ts
autonomous: true

must_haves:
  truths:
    - "SignalWeightConfig type defines all 7 core signals (0-1 normalized)"
    - "Role-type presets exist for executive, manager, ic, and default profiles"
    - "Environment variables allow default weight customization"
    - "resolveWeights function merges request overrides with role presets"
  artifacts:
    - path: "services/hh-search-svc/src/signal-weights.ts"
      provides: "Signal weight types and role-type presets"
      exports: ["SignalWeightConfig", "RoleType", "ROLE_WEIGHT_PRESETS", "resolveWeights", "normalizeWeights"]
    - path: "services/hh-search-svc/src/config.ts"
      provides: "Signal weight environment variable configuration"
      contains: "SIGNAL_WEIGHT_"
  key_links:
    - from: "services/hh-search-svc/src/signal-weights.ts"
      to: "services/hh-search-svc/src/config.ts"
      via: "Environment variable defaults imported"
      pattern: "getSignalWeightDefaults"
---

<objective>
Create the signal weight configuration foundation with TypeScript types, role-type presets, and environment variable support.

Purpose: Establish the configurable weight system that replaces hardcoded weights in legacy-engine.ts. This enables per-search and per-role-type weight customization.

Output:
- New `signal-weights.ts` module with types, presets, and utility functions
- Extended `config.ts` with signal weight environment variables
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-multi-signal-scoring-framework/04-RESEARCH.md

# Reference files
@services/hh-search-svc/src/config.ts
@services/hh-search-svc/src/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SignalWeightConfig types and role-type presets</name>
  <files>services/hh-search-svc/src/signal-weights.ts</files>
  <action>
Create a new module `signal-weights.ts` with:

1. **SignalWeightConfig interface** - All 7 core signals (0-1 weights that sum to 1.0):
   - vectorSimilarity: Vector search score weight
   - levelMatch: Seniority/level alignment weight
   - specialtyMatch: Specialty match (backend, frontend, etc.) weight
   - techStackMatch: Tech stack compatibility weight
   - functionMatch: Function alignment (engineering, product, etc.) weight
   - trajectoryFit: Career trajectory fit weight
   - companyPedigree: Company pedigree weight
   - Optional: skillsMatch (for future skill-aware searches)

2. **RoleType union** - `'executive' | 'manager' | 'ic' | 'default'`

3. **ROLE_WEIGHT_PRESETS constant** - Record<RoleType, SignalWeightConfig> with:
   - executive: { vectorSimilarity: 0.10, levelMatch: 0.20, specialtyMatch: 0.05, techStackMatch: 0.05, functionMatch: 0.25, trajectoryFit: 0.15, companyPedigree: 0.20 }
   - manager: Balanced weights (0.15 each with slight emphasis on function/trajectory)
   - ic: { vectorSimilarity: 0.20, levelMatch: 0.15, specialtyMatch: 0.20, techStackMatch: 0.20, functionMatch: 0.10, trajectoryFit: 0.10, companyPedigree: 0.05 }
   - default: Balanced across all signals (0.15 each, 0.10 for trajectory)

4. **normalizeWeights function** - Ensures weights sum to 1.0:
   - Calculate sum of all weight values
   - If abs(sum - 1.0) > 0.001, normalize each weight by dividing by sum
   - Log warning when normalization applied
   - Return normalized SignalWeightConfig

5. **resolveWeights function** - Merges request overrides with role presets:
   - Takes requestWeights: Partial<SignalWeightConfig> | undefined
   - Takes roleType: RoleType (defaults to 'default')
   - Gets base weights from ROLE_WEIGHT_PRESETS[roleType]
   - Merges request overrides: { ...baseWeights, ...requestWeights }
   - Calls normalizeWeights to ensure sum = 1.0
   - Returns final SignalWeightConfig

Export all types, constants, and functions.
  </action>
  <verify>
- `npm run typecheck --prefix services/hh-search-svc` passes
- `grep -r "SignalWeightConfig" services/hh-search-svc/src/signal-weights.ts` shows exported type
- `grep -r "ROLE_WEIGHT_PRESETS" services/hh-search-svc/src/signal-weights.ts` shows all 4 role types
  </verify>
  <done>
- SignalWeightConfig interface defines all 7 signals with optional skillsMatch
- RoleType union covers all 4 role categories
- ROLE_WEIGHT_PRESETS has correct values for each role type
- normalizeWeights handles weight sum validation
- resolveWeights merges and normalizes correctly
  </done>
</task>

<task type="auto">
  <name>Task 2: Add signal weight environment variables to config</name>
  <files>services/hh-search-svc/src/config.ts</files>
  <action>
Extend the config module to support signal weight environment variables:

1. **Add SignalWeightEnvConfig interface**:
   ```typescript
   export interface SignalWeightEnvConfig {
     defaultVectorWeight: number;
     defaultLevelWeight: number;
     defaultSpecialtyWeight: number;
     defaultTechStackWeight: number;
     defaultFunctionWeight: number;
     defaultTrajectoryWeight: number;
     defaultCompanyWeight: number;
     geminiBlendWeight: number;  // Weight for Gemini rerank blending (default 0.7)
   }
   ```

2. **Add to SearchServiceConfig interface**:
   - Add `signalWeights: SignalWeightEnvConfig` field

3. **Parse environment variables in getSearchServiceConfig()**:
   ```typescript
   const signalWeights: SignalWeightEnvConfig = {
     defaultVectorWeight: parseNumber(process.env.SIGNAL_WEIGHT_VECTOR, 0.15),
     defaultLevelWeight: parseNumber(process.env.SIGNAL_WEIGHT_LEVEL, 0.15),
     defaultSpecialtyWeight: parseNumber(process.env.SIGNAL_WEIGHT_SPECIALTY, 0.15),
     defaultTechStackWeight: parseNumber(process.env.SIGNAL_WEIGHT_TECH_STACK, 0.15),
     defaultFunctionWeight: parseNumber(process.env.SIGNAL_WEIGHT_FUNCTION, 0.15),
     defaultTrajectoryWeight: parseNumber(process.env.SIGNAL_WEIGHT_TRAJECTORY, 0.10),
     defaultCompanyWeight: parseNumber(process.env.SIGNAL_WEIGHT_COMPANY, 0.15),
     geminiBlendWeight: parseNumber(process.env.GEMINI_BLEND_WEIGHT, 0.7)
   };
   ```

4. **Add signalWeights to cachedConfig**

5. **Add getSignalWeightDefaults() export function**:
   - Returns SignalWeightConfig built from env vars
   - Used by signal-weights.ts as fallback defaults
  </action>
  <verify>
- `npm run typecheck --prefix services/hh-search-svc` passes
- `grep "SIGNAL_WEIGHT" services/hh-search-svc/src/config.ts` shows all env var parsing
- `grep "geminiBlendWeight" services/hh-search-svc/src/config.ts` shows Gemini blend config
  </verify>
  <done>
- SignalWeightEnvConfig interface exists with all 8 fields
- SearchServiceConfig includes signalWeights property
- All SIGNAL_WEIGHT_* env vars are parsed with correct defaults
- GEMINI_BLEND_WEIGHT env var is parsed (default 0.7)
- getSignalWeightDefaults() function is exported
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `npm run typecheck --prefix services/hh-search-svc`
2. Unit test (optional): Create test for normalizeWeights and resolveWeights functions
3. Integration: Verify signal-weights.ts can import from config.ts
</verification>

<success_criteria>
- SignalWeightConfig type is defined with all 7 core signals
- ROLE_WEIGHT_PRESETS has 4 role types with appropriate weight distributions
- Environment variables allow customization of default weights
- resolveWeights correctly merges and normalizes weight configurations
- All TypeScript types compile without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-multi-signal-scoring-framework/04-01-SUMMARY.md`
</output>
