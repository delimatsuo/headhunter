---
phase: 04-multi-signal-scoring-framework
plan: 05
type: execute
wave: 4
depends_on: ["04-03", "04-04"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Search returns signalScores for each candidate (all 7 signals, 0-1 normalized)"
    - "Custom signal weights in request are applied to scoring"
    - "Role type presets produce different rankings for same candidates"
    - "Response metadata shows weightsApplied and roleTypeUsed"
  artifacts: []
  key_links: []
---

<objective>
Verify the multi-signal scoring framework implementation meets all Phase 4 requirements.

Purpose: End-to-end verification that SCOR-01, SCOR-07, and SCOR-08 are working correctly. Confirm signal scores are normalized, weights are configurable, and final scores are weighted combinations.

Output:
- Verification that all Phase 4 requirements are met
- Documentation of any issues found
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-multi-signal-scoring-framework/04-RESEARCH.md
@.planning/phases/04-multi-signal-scoring-framework/04-01-SUMMARY.md
@.planning/phases/04-multi-signal-scoring-framework/04-02-SUMMARY.md
@.planning/phases/04-multi-signal-scoring-framework/04-03-SUMMARY.md
@.planning/phases/04-multi-signal-scoring-framework/04-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Compile and build verification</name>
  <files></files>
  <action>
Verify all code compiles and builds successfully:

1. **TypeScript type check**:
   ```bash
   npm run typecheck --prefix services/hh-search-svc
   ```

2. **Build the service**:
   ```bash
   npm run build --prefix services/hh-search-svc
   ```

3. **Run existing tests** (if any):
   ```bash
   npm test --prefix services/hh-search-svc 2>/dev/null || echo "No tests or tests skipped"
   ```

4. **Check for circular dependencies**:
   - Verify signal-weights.ts and scoring.ts don't create import cycles
   - Check that config.ts doesn't import from signal-weights.ts (would be circular)

5. **Verify exports**:
   ```bash
   # Check that key exports are present
   grep -l "SignalWeightConfig" services/hh-search-svc/src/index.ts
   grep -l "computeWeightedScore" services/hh-search-svc/src/index.ts
   ```
  </action>
  <verify>
- All commands exit with code 0
- No TypeScript errors in output
- Build produces dist/ files
  </verify>
  <done>
- TypeScript compilation passes
- Service builds successfully
- No circular dependency warnings
- All required exports are present
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Multi-signal scoring framework for hh-search-svc with:
- SignalWeightConfig types and role-type presets
- Environment variable configuration
- Weighted score computation (SCOR-08)
- Signal scores in response (SCOR-01)
- Configurable weights via request (SCOR-07)</what-built>
  <how-to-verify>
1. **Start the service locally** (or verify in dev environment):
   ```bash
   cd services/hh-search-svc
   npm run dev
   ```

2. **Test default weights (SCOR-08)**:
   Send a search request without signalWeights:
   ```bash
   curl -X POST http://localhost:7102/search \
     -H "Content-Type: application/json" \
     -d '{
       "query": "Senior Backend Engineer",
       "limit": 5,
       "includeDebug": true
     }'
   ```

   Verify in response:
   - Each result has `signalScores` object with 7 signals
   - Each result has `weightsApplied` showing default weights
   - Each result has `roleTypeUsed: "default"`
   - `debug.signalScoringConfig` shows configuration

3. **Test role-type presets (SCOR-07)**:
   Send a search with executive role type:
   ```bash
   curl -X POST http://localhost:7102/search \
     -H "Content-Type: application/json" \
     -d '{
       "query": "VP Engineering",
       "roleType": "executive",
       "limit": 5,
       "includeDebug": true
     }'
   ```

   Verify:
   - `roleTypeUsed: "executive"`
   - `weightsApplied` shows executive preset (higher functionMatch, companyPedigree)

4. **Test custom weight override (SCOR-07)**:
   ```bash
   curl -X POST http://localhost:7102/search \
     -H "Content-Type: application/json" \
     -d '{
       "query": "Python Developer",
       "signalWeights": {
         "vectorSimilarity": 0.5,
         "techStackMatch": 0.3,
         "specialtyMatch": 0.2
       },
       "limit": 5,
       "includeDebug": true
     }'
   ```

   Verify:
   - `weightsApplied` reflects merged+normalized custom weights
   - Weights sum to 1.0 (normalization applied)

5. **Verify signal score normalization (SCOR-01)**:
   - Check that `signalScores.vectorSimilarity` is 0-1 range
   - Check that all signal values are 0-1 range
   - No NaN or undefined values

6. **Verify score computation (SCOR-08)**:
   - `score` field should reflect weighted combination
   - Check debug.scoreBreakdown shows individual signals
  </how-to-verify>
  <resume-signal>
Type "verified" if all checks pass.
If issues found, describe them for debugging.
  </resume-signal>
</task>

</tasks>

<verification>
Requirements verification:

| Requirement | Verification Method | Expected Outcome |
|-------------|---------------------|------------------|
| SCOR-01: Vector similarity (0-1) | Check signalScores.vectorSimilarity | 0-1 normalized value |
| SCOR-07: Configurable weights | Test with roleType and signalWeights | Different weight presets applied |
| SCOR-08: Weighted combination | Check final score computation | Score = sum(signal * weight) |
</verification>

<success_criteria>
Phase 4 requirements verified:
1. Each candidate result includes vector_similarity_score field (0-1 normalized) - SCOR-01
2. Search request can include custom signal weights - SCOR-07
3. Final match score is computed as weighted sum - SCOR-08
4. Default weights are applied when no custom weights specified
5. Signal weights can be configured per role type (IC vs Manager vs Executive)
</success_criteria>

<output>
After completion, create `.planning/phases/04-multi-signal-scoring-framework/04-05-SUMMARY.md`

Update `.planning/STATE.md`:
- Set Phase 4 status to COMPLETE
- Add Phase 4 key decisions
- Update progress metrics
- Add TODOs completed
</output>
