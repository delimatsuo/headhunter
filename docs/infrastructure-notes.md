# Headhunter Infrastructure Notes

> **Auto-generated infrastructure documentation**
> This file is generated by `scripts/generate-infrastructure-notes.sh`
> Last updated: 2025-09-30 21:23:31 UTC

## Overview

This document contains details about all provisioned GCP resources for the Headhunter platform.


### Project Information

- **Project ID**: `headhunter-ai-0088`
- **Project Number**: `1034162584026`
- **Primary Region**: `us-central1`
- **Billing Account**: `billingAccounts/016AF3-DCA145-D2D640`

---

## Network Configuration

### VPC Network

- **VPC Name**: `vpc-hh`
- **Subnet**: `headhunter-subnet`
- **Subnet Range**: `10.0.0.0/24`


**VPC Details:**
```json
{
  "autoCreateSubnetworks": false,
  "creationTimestamp": "2025-09-30T12:44:57.526-07:00",
  "id": "8287473098176957910",
  "kind": "compute#network",
  "name": "vpc-hh",
  "networkFirewallPolicyEnforcementOrder": "AFTER_CLASSIC_FIREWALL",
  "peerings": [
    {
      "autoCreateRoutes": true,
      "connectionStatus": {
        "trafficConfiguration": {
          "exportCustomRoutesToPeer": false,
          "exportSubnetRoutesWithPublicIpToPeer": false,
          "importCustomRoutesFromPeer": false,
          "importSubnetRoutesWithPublicIpFromPeer": false,
          "stackType": "IPV4_ONLY"
        },
        "updateStrategy": "INDEPENDENT"
      },
      "exchangeSubnetRoutes": true,
      "exportCustomRoutes": false,
      "exportSubnetRoutesWithPublicIp": false,
      "importCustomRoutes": false,
      "importSubnetRoutesWithPublicIp": false,
      "name": "servicenetworking-googleapis-com",
      "network": "https://www.googleapis.com/compute/v1/projects/l3f0e77f983a66755p-tp/global/networks/servicenetworking",
      "stackType": "IPV4_ONLY",
      "state": "ACTIVE",
      "stateDetails": "[2025-09-30T14:00:11.673-07:00]: Connected.",
      "updateStrategy": "INDEPENDENT"
    }
  ],
  "routingConfig": {
    "bgpBestPathSelectionMode": "LEGACY",
    "routingMode": "REGIONAL"
  },
  "selfLink": "https://www.googleapis.com/compute/v1/projects/headhunter-ai-0088/global/networks/vpc-hh",
  "selfLinkWithId": "https://www.googleapis.com/compute/v1/projects/headhunter-ai-0088/global/networks/8287473098176957910",
  "subnetworks": [
    "https://www.googleapis.com/compute/v1/projects/headhunter-ai-0088/regions/us-central1/subnetworks/hh-redis-subnet",
    "https://www.googleapis.com/compute/v1/projects/headhunter-ai-0088/regions/us-central1/subnetworks/hh-sql-subnet",
    "https://www.googleapis.com/compute/v1/projects/headhunter-ai-0088/regions/us-central1/subnetworks/hh-run-subnet",
    "https://www.googleapis.com/compute/v1/projects/headhunter-ai-0088/regions/us-central1/subnetworks/aet-uscentral1-svpc--us--central1-sbnt"
  ],
  "x_gcloud_bgp_routing_mode": "REGIONAL",
  "x_gcloud_subnet_mode": "CUSTOM"
}
```


### VPC Connector

- **Connector Name**: `headhunter-connector`
- **Region**: `us-central1`


---

## Database Resources

### Cloud SQL (PostgreSQL + pgvector)

- **Instance Name**: `headhunter-db-primary`
- **Connection Name**: `not-found`
- **Private IP**: `not-found`
- **Database Version**: `not-found`
- **Region**: `us-central1`

**Connection String (Cloud Run):**
```bash
postgres://USER:PASSWORD@not-found:5432/DATABASE_NAME
```

**Cloud SQL Proxy Connection (Local Development):**
```bash
# Start Cloud SQL Proxy
cloud_sql_proxy -instances=not-found=tcp:5432

# Connect via psql
psql "host=127.0.0.1 port=5432 dbname=headhunter user=headhunter_app"
```

**Environment Variables for Cloud Run:**
```bash
DB_HOST=not-found
DB_PORT=5432
DB_NAME=headhunter
DB_USER=headhunter_app
# DB_PASSWORD from Secret Manager: db-primary-password
```

---

## Cache Layer

### Redis (Memorystore)

- **Instance Name**: `headhunter-redis`
- **Host**: `not-found`
- **Port**: `not-found`
- **Version**: `not-found`
- **Region**: `us-central1`

**Connection URI:**
```
redis://not-found:not-found
```

**Environment Variables for Cloud Run:**
```bash
REDIS_HOST=not-found
REDIS_PORT=not-found
```

**Note**: Redis is only accessible via VPC. Cloud Run services must use the VPC connector.

---

## Message Queue

### Pub/Sub Topics

- `candidate-enrichment`
- `candidate-processing-dlq`
- `postings.refresh.request`
- `profiles.refresh.request`
- `refresh.jobs.dlq`
- `eventarc-us-central1-processuploadedprofile-215196-823`
- `eventarc-us-central1-processuploadedfile-894723-058`

### Pub/Sub Subscriptions

- `postings.refresh.request.sub`
- `profiles.refresh.request.sub`
- `refresh.jobs.dlq.sub`
- `eventarc-us-central1-processuploadedfile-894723-sub-326`
- `eventarc-us-central1-processuploadedprofile-215196-sub-915`

**Publishing to a Topic:**
```bash
gcloud pubsub topics publish TOPIC_NAME --message="MESSAGE_CONTENT"
```

---

## Storage

### Cloud Storage Buckets

- `gs://gcf-v2-sources-1034162584026-us-central1`
- `gs://gcf-v2-uploads-1034162584026.us-central1.cloudfunctions.appspot.com`
- `gs://headhunter-ai-0088-embeddings`
- `gs://headhunter-ai-0088-files`
- `gs://headhunter-ai-0088-profiles`
- `gs://headhunter-ai-0088-profiles-1757350125`
- `gs://headhunter-ai-0088-raw-csv`
- `gs://headhunter-ai-0088-raw-json`
- `gs://headhunter-ai-0088.firebasestorage.app`
- `gs://headhunter-ai-0088_cloudbuild`
- `gs://hh-exports-us-central1` (Data exports)
- `gs://hh-postings-us-central1`
- `gs://hh-processed-artifacts-us-central1`
- `gs://hh-raw-profiles-us-central1`
- `gs://run-sources-headhunter-ai-0088-us-central1`

**Uploading to a bucket:**
```bash
gsutil cp LOCAL_FILE gs://BUCKET_NAME/path/to/file
```

---

## Secrets

### Secret Manager

- `db-analytics-password`
- `db-primary-password`
- `db-replica-password`
- `gemini-api-key`
- `oauth-client-credentials`
- `redis-endpoint`
- `storage-signer-key`
- `together-ai-api-key`
- `together-ai-credentials`

**Accessing a secret:**
```bash
gcloud secrets versions access latest --secret=SECRET_NAME --project=headhunter-ai-0088
```

**Updating a secret:**
```bash
echo -n "NEW_SECRET_VALUE" | gcloud secrets versions add SECRET_NAME --data-file=-
```

**Environment Variables from Secrets (Cloud Run):**
```bash
gcloud run deploy SERVICE_NAME \
  --set-secrets=DB_PASSWORD=db-primary-password:latest,\
TOGETHER_API_KEY=together-api-key:latest
```

---

## Firestore

- **Database**: `(default)`
- **Location**: `us-central1`
- **Mode**: `FIRESTORE_NATIVE`

**Firestore Connection (Cloud Run):**

Cloud Run services automatically have access to Firestore via Application Default Credentials.

```typescript
import { Firestore } from '@google-cloud/firestore';
const firestore = new Firestore({
  projectId: 'headhunter-ai-0088'
});
```

---

## Service Accounts

```
EMAIL                                                               DISPLAY NAME
headhunter-ai-0088@appspot.gserviceaccount.com                      App Engine default service account
headhunter-service@headhunter-ai-0088.iam.gserviceaccount.com       Headhunter AI Service Account
1034162584026-compute@developer.gserviceaccount.com                 Default compute service account
firebase-adminsdk-fbsvc@headhunter-ai-0088.iam.gserviceaccount.com  firebase-adminsdk
candidate-enricher-sa@headhunter-ai-0088.iam.gserviceaccount.com    Candidate Enricher Service Account
```


---

## Connection Strings & Environment Variables

### Complete .env Template for Cloud Run Services

```bash
# Project
PROJECT_ID=headhunter-ai-0088
REGION=us-central1

# Database
DB_HOST=not-found
DB_PORT=5432
DB_NAME=headhunter
DB_USER=headhunter_app
# DB_PASSWORD=<from Secret Manager: db-primary-password>

# Redis
REDIS_HOST=not-found
REDIS_PORT=not-found

# Together AI
# TOGETHER_API_KEY=<from Secret Manager: together-api-key>

# Gemini (optional)
# GEMINI_API_KEY=<from Secret Manager: gemini-api-key>
```

---

## Next Steps

### 1. Populate Secrets with Real Values

The infrastructure provisioning creates placeholder secrets. You need to populate them with actual values:

```bash
# Database password
echo -n "YOUR_SECURE_PASSWORD" | gcloud secrets versions add db-primary-password --data-file=-

# Together AI API key
echo -n "YOUR_TOGETHER_API_KEY" | gcloud secrets versions add together-api-key --data-file=-

# Gemini API key (optional)
echo -n "YOUR_GEMINI_API_KEY" | gcloud secrets versions add gemini-api-key --data-file=-
```

### 2. Deploy Cloud Run Services

Follow the deployment guides:
- Evidence Service: `docs/deployment/evidence-service.md`
- ECO Service: `docs/deployment/eco-service.md`
- Admin Service: `docs/deployment/admin-service.md`
- Enrich Service: `docs/deployment/enrich-service.md`
- Messages Service: `docs/deployment/msgs-service.md`
- Search Service: `docs/deployment/search-service.md`

### 3. Configure API Gateway

Setup the API Gateway to route requests to Cloud Run services:
```bash
./scripts/deploy_api_gateway.sh --project-id=headhunter-ai-0088
```

### 4. Run Post-Deployment Validation

```bash
./scripts/validate_headhunter_infrastructure.sh --project-id=headhunter-ai-0088
```

### 5. Configure Monitoring & Alerting

Setup Cloud Monitoring dashboards and alerting:
```bash
./scripts/setup_cloud_monitoring_dashboards.py --project-id=headhunter-ai-0088
./scripts/setup_production_alerting.py --project-id=headhunter-ai-0088
```

---

## Validation Results

Infrastructure validation report for project headhunter-ai-0088
Generated: 2025-09-30T21:23:31Z
\n--- API Checks ---\n[PASS] run.googleapis.com enabled\n[PASS] sqladmin.googleapis.com enabled\n[PASS] redis.googleapis.com enabled\n[PASS] secretmanager.googleapis.com enabled\n[PASS] pubsub.googleapis.com enabled\n[PASS] storage.googleapis.com enabled\n[PASS] aiplatform.googleapis.com enabled\n[PASS] firestore.googleapis.com enabled\n[PASS] vpcaccess.googleapis.com enabled\n[PASS] compute.googleapis.com enabled\n[PASS] logging.googleapis.com enabled\n[PASS] monitoring.googleapis.com enabled\n[PASS] cloudtrace.googleapis.com enabled\n[PASS] cloudscheduler.googleapis.com enabled\n[PASS] artifactregistry.googleapis.com enabled\n\n--- Networking ---\n[PASS] VPC vpc-hh exists\n[PASS] Connector svpc-us-central1 exists\n[PASS] Cloud NAT hh-nat-gateway exists\n[WARN] CONNECTOR_EGRESS_ALLOWED_CIDRS currently allows 0.0.0.0/0; tighten the range and deploy Cloud Run services with --vpc-connector "svpc-us-central1" and --vpc-egress all-traffic to enforce egress policy.\n\n--- Cloud SQL ---\n[PASS] Instance sql-hh-core exists\n[PASS] Database headhunter exists\n[FAIL] cloudsql.enable_pgvector flag missing\n[WARN] pgvector extension check skipped (cloud_sql_proxy not installed for SQL validation)\n[WARN] search.candidate_embeddings table check skipped (cloud_sql_proxy not installed for SQL validation)\n\n--- Memorystore ---\n[PASS] Redis redis-skills-us-central1 exists\n\n--- Pub/Sub ---\n[PASS] Topic profiles.refresh.request exists\n[PASS] Topic postings.refresh.request exists\n[PASS] Topic refresh.jobs.dlq exists\n[PASS] Subscription profiles.refresh.request.sub exists\n[PASS] Subscription postings.refresh.request.sub exists\n\n--- Cloud Storage ---\n[PASS] Bucket hh-raw-profiles-us-central1 exists\n[PASS] Bucket hh-postings-us-central1 exists\n[PASS] Bucket hh-processed-artifacts-us-central1 exists\n[PASS] Bucket hh-exports-us-central1 exists\n\n--- Secret Manager ---\n[PASS] Secret db-primary-password exists\n[PASS] Secret db-replica-password exists\n[PASS] Secret db-analytics-password exists\n[PASS] Secret together-ai-api-key exists\n[PASS] Secret gemini-api-key exists\n[PASS] Secret oauth-client-credentials exists\n[PASS] Secret redis-endpoint exists\n[PASS] Secret storage-signer-key exists\n\n--- IAM Role Checks ---\n[FAIL] Service account embed-production missing\n[FAIL] Service account rerank-production missing\n[FAIL] Service account msgs-production missing\n[FAIL] Service account search-production missing\n[FAIL] Service account admin-production missing\n[FAIL] Service account enrich-production missing\n[FAIL] Service account evidence-production missing\n[FAIL] Service account eco-production missing\n

---

## Manual Notes

<!-- Add custom notes, troubleshooting info, or configuration details here -->
<!-- This section will not be overwritten when regenerating infrastructure notes -->

